FROM ubuntu:xenial
MAINTAINER NFS86 <jarbull86@gmail.com>

ENV DEBIAN_FRONTEND noninteractive
ENV LANG=C.UTF-8
ENV LC_ALL=C
ENV USE_CCACHE=1
ENV ANDROID_JACK_VM_ARGS="-Dfile.encoding=UTF-8 -XX:+TieredCompilation -Xmx120G"
ENV JAVA_OPTS=" -Xmx120G "
ENV BUILD_USERNAME=cirrus
ENV CCACHE_EXEC=/usr/bin/ccache
ENV BUILD_HOSTNAME=nfsproject
ENV JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
ENV USER=cirrus
ENV HOSTNAME=nfs-project
ENV TZ Asia/Jakarta
WORKDIR /tmp

RUN rm -f \
    /etc/profile \
    ~/.profile \
    ~/.bashrc

COPY ./proprietary /

RUN apt update

RUN apt install apt-utils sudo -y

RUN apt-get -yqq update \
    && apt-get install --no-install-recommends -yqq git nano wget curl python bc bison build-essential g++ gcc clang llvm ccache sudo --fix-broken --fix-missing

RUN apt-get -y update && apt-get -y upgrade && apt-get -y install git cmake clang-format clang-tidy clang libc++-dev libc++1 libc++abi-dev libc++abi1 libclang-dev libclang1 libomp-dev libomp5 llvm-dev llvm-runtime llvm python build-essential make bzip2 libncurses5-dev libssl-dev ninja-build liblz4-tool bc curl unzip lzop ccache flex strace bison libc6 libstdc++6 wget p7zip-full zip python3 python3-pip tzdata gcc-arm-linux-gnueabi nano bc bison ca-certificates curl flex gcc git libc6-dev libssl-dev openssl python ssh wget zip zstd sudo make clang gcc-arm-linux-gnueabi software-properties-common \
    && apt-get -y install python3 git cmake clang-format clang-tidy clang libc++-dev libc++1 libc++abi-dev libc++abi1 libclang-dev libclang1 libllvm-ocaml-dev libomp-dev libomp5 lldb llvm-dev llvm-runtime llvm build-essential make bzip2 libncurses5-dev libssl-dev python3-pip ninja-build \
    && pip3 install psutil \
    && apt-get -y install openssh-server screen python git android-tools-adb bc bison build-essential curl flex gnupg gperf imagemagick liblz4-tool libncurses5-dev libsdl1.2-dev libssl-dev libxml2 libxml2-utils lzop pngcrush rsync schedtool squashfs-tools xsltproc yasm zip zlib1g-dev libtinfo5 libncurses5

RUN apt-get -y install gcc-4.9 g++-4.9 gcc-4.9-aarch64-linux-gnu gcc-4.9-arm-linux-gnueabi g++-4.9-arm-linux-gnueabi

RUN sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.9 20 --slave /usr/bin/g++ g++ /usr/bin/g++-4.9 \
    && sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.9 20 \
    && sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.9 20 \
    && sudo update-alternatives --install /usr/bin/cc cc /usr/bin/gcc 30 \
    && sudo update-alternatives --set cc /usr/bin/gcc \
    && sudo update-alternatives --install /usr/bin/c++ c++ /usr/bin/g++ 30 \
    && sudo update-alternatives --set c++ /usr/bin/g++ \
    && sudo update-alternatives --config gcc \
    && sudo update-alternatives --config g++ \
    && ls -la /usr/bin/ | grep -oP "[\S]*(gcc|g\+\+)(-[a-z]+)*[\s]" | xargs bash -c 'for link in ${@:1}; do sudo ln -s -f "/usr/bin/${link}-${0}" "/usr/bin/${link}"; done' 4.9 \
    && ls -la /usr/bin/ | grep -oP "[\S]*(gcc|g\+\+)(-[a-z]+)*[\s]" | xargs bash -c 'for link in ${@:1}; do echo sudo ln -s -f "/usr/bin/${link}-${0}" "/usr/bin/${link}"; done' 4.9 \
    && sudo ln -s -f /usr/bin/g++-4.9 /usr/bin/g++ \
    && sudo ln -s -f /usr/bin/gcc-4.9 /usr/bin/gcc \
    && sudo ln -s -f /usr/bin/gcc-ar-4.9 /usr/bin/gcc-ar \
    && sudo ln -s -f /usr/bin/gcc-nm-4.9 /usr/bin/gcc-nm \
    && sudo ln -s -f /usr/bin/gcc-ranlib-4.9 /usr/bin/gcc-ranlib \
    && sudo ln -s -f /usr/bin/aarch64-linux-gnu-g++-4.9 /usr/bin/aarch64-linux-gnu-g++ \
    && sudo ln -s -f /usr/bin/aarch64-linux-gnu-gcc-4.9 /usr/bin/aarch64-linux-gnu-gcc \
    && sudo ln -s -f /usr/bin/aarch64-linux-gnu-gcc-ar-4.9 /usr/bin/aarch64-linux-gnu-gcc-ar \
    && sudo ln -s -f /usr/bin/aarch64-linux-gnu-gcc-nm-4.9 /usr/bin/aarch64-linux-gnu-gcc-nm \
    && sudo ln -s -f /usr/bin/aarch64-linux-gnu-gcc-ranlib-4.9 /usr/bin/aarch64-linux-gnu-gcc-ranlib
